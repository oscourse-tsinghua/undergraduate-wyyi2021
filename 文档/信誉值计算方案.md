# 信誉值计算方案

## 考虑因素

- 新注册用户
- 数据更新频率
  - 稳定的参与
  - 具体活跃程度
- 行驶速度？
- 是否为已知联络人
- 来自邻居的位置验证
  - 请求/响应的地理位置在设定范围之外
  - 请求/响应的地理位置在附近，但不能由短距离通信联系到

- 与其它车辆达成的交易
  - 交易方/签署方
- 数据、消息传播（辅助，因为数据信息交换相对稀疏，并且用于信誉计算可能延迟较大）
  - 消息的原创性/冲突
    - 冲突消息：冲突是客观原因导致的不同；伪造是主观原因导致的不同，错误的收益方是自己
    - 抄袭：伪造信息来源
  - 车辆与事件之间的距离
  - 接收信号强度（RSS）
  - 接收到消息的车辆数量（受了该消息影响的邻居规模）
- 对欺骗行为的举报



## 需要防范的攻击

- Prover使用自己的位置信息和另一人的身份信息发送请求
- 邻居为Prover生成虚假的位置验证/交易成功信息
- 邻居为Prover生成恶意的位置验证/交易失败信息



## 计算

- 信誉值范围：0-100的整数，高于某个阈值$T$则被判定为可信的
- 新注册用户的初始信誉值为$T_0$，$T_0<T$？
- 数据长时间不更新的，信誉值减小，采用分段函数？两种方案：
  - 检查最后两次提交的时间间隔
  - 检查最后两次提交的区块间隔
  - 稳定、持续地高活跃度可适当增加信誉（奖励要明显小于恶意行为可能导致的惩罚）
- 成功/失败的位置验证对信誉值影响
  - 两者加权，计算一个信誉值的偏移量，加到原信誉值上。
  - 比如：$\Delta=\theta_1*(success-s_0)+\theta_2*failure$
    - 用户完成了一定数量的成功位置验证信誉值才会增加，防止合谋
    - 验证失败必然会降低可信度
  - 后续可以考虑区分请求者和邻居身份的信誉值
    - 两种身份的偏移量计算公式与上面类似，各取不同的参数
    - 区别错误信息，看位置验证失败是哪一方的问题
    - 也可以把这两个（加权）平均一下，相当于成功的位置验证同时影响双方信誉
- 成功交易
  - 涉及到实际交易，相应的信誉奖励可以相对更大
  - 与交易数额、交易类型相关
- 消息传播
  - 报告行驶状态、交通状况（周期性）
    - 结合位置验证、多车消息汇总情况（和道路修正？）判断其真实度、准确性
  - 对突发事件的响应和警告（一次性）
    - 由多车消息汇总情况判断其真实度、准确性
    - 可设定响应级别，信誉奖励/惩罚与级别正相关
  - 消息真实度决定信誉增加还是减少；可以考虑再加入具体量化的准确性
    - 邻居的距离帮助判定消息真实度
  - 信誉偏移量与车流密度正相关，（可选）与发送时间负相关（越早发出信誉偏移量越大）
  - 奖励与惩罚分别设置系数
- 举报恶意行为（偶尔）
  - 对于位置验证、交易、消息中的欺骗行为，统一通过发送消息进行举报？
  - 如何认定举报是合理的？？
    - 被多人举报可认定为恶意（对于部分位置验证、交易可能无法实现）
    - 公职机构/投票，可以事后判断（评价体系）
    - 鼓励无关的第三方进行举报
  - 成功举报使信誉增加；恶意的举报使信誉减少
- 邻居对消息的评价

**信誉计算实体：合约（主要的计算实体）、用户参与（辅助参与者）**



## 公式

### 初始值

$T_0$：小于可信阈值

### 更新时间

- 衰减系数计算
  $$
  D(t)=\frac{1}{\delta*(t-t_l)}
  $$
  $t_l$为上一次提交数据的时间，$t$为本次提交数据/计算当前信誉值对应的时间。

  下文所述的信誉偏移量，叠加衰减系数之后用于计算车辆新的信誉值：
  $$
  T'=T+D(t)*\Delta T
  $$
  

### 位置验证

作为位置验证发出者（Verifier）的信誉偏移：
$$
\Delta T_{\rm V}=\theta_{v1}*(success-s_v)+\theta_{v2}*failure
$$
作为提供位置验证邻居（Neighbour）的信誉偏移：
$$
\Delta T_{\rm N}=\theta_{n1}*(success-s_n)+\theta_{n2}*failure
$$
其中$success$、$failure$分别为成功、失败地收到或给出的位置验证。

由位置验证导致的信誉值总偏移量为：
$$
\Delta T = \Delta T_{\rm V}+\Delta T_{\rm N}
$$

### 消息

- 可信度与邻居评价

  邻居$j$可对其收到的、来自车辆$i$的消息$m$进行打分$R_j^m$。消息$m$的整体可信度为：
  $$
  Cred_m=\frac{\sum_jw_{ij}*R_j^m}{\sum_jw_{ij}}
  $$
  其中权重$w_{ij}$由车辆$i$、$j$的距离$dis(i,j)$决定：
  $$
  w_{ij}=e^{-\gamma* dis(i,j)}+b
  $$
  

  当$Cred_m\ge C_0$时消息$m$被判定为可信。

- 消息发送者的信誉

  车流密度为$D$，消息级别为$L$（$L=1$：事故警告；$L=2$：路况提示；$L=3$：周期性报告）

  判断消息是否可信后，决定信誉值增加或减少：
  $$
  \Delta T=\left\{
  \begin{array}{l}
  Reward=\alpha*D*\frac{1}{e^L}       &      & {消息可信}\\
  Punishment=(-1)*\beta*D*\frac{1}{e^L}     &      & {消息不可信}\\
  \end{array} \right.
  $$

- 举报

  对于被举报者：
  $$
  \Delta T=\lambda_P*Punishment
  $$
  对于举报者：
  $$
  \Delta T=\lambda_R*Reward
  $$

### 事故等特殊情况（待考虑）

- **结合速度**
- 一辆车的交通事故，密度低，但是速度为0，如果这辆车发送位置验证，可信度是不是可以增加？
- 多辆车的连环事故，互相验证时可信度可能不高，但结合发送验证前后的行驶速度，可以修正可信度？
- 对于消息**内容**的依赖性（应用层面）



## 使用

### 位置验证

- 简单：低于可信阈值的不能作为邻居提供位置验证

- 复杂：每条位置验证有自己的可信度，可以是验证双方信誉值的（加权）平均
  - 按阈值划分可信/不可信
- 注意，要让有恶意行为的车辆受到惩罚，但是对偶尔/不得已出现了故障的车辆，信誉值在行为正常时还能再涨回去

### 道路匹配和位置修正

### 路况计算

- 低于可信阈值的数据直接丢弃



## 模拟测试

### 测试方法

- 在模拟的田字格道路上进行测试，关注一个车辆的信誉值变化
- 田字格边长为100（个数据点）
- 与目标车辆进行交互的其他车辆随机静止分布在道路上，两车处于同一位置时模拟交互
- 进入新的田字格边时，位置验证的成功、失败次数清零
- 在遇到较密集车辆群时模拟消息发送，车辆距离由数据点间隔表示
- 消息可以发送给与目标车辆距离在五个数据点之内的其他车辆

### 参数

$$
\delta=0.2 \\
\theta_{v1}=2,s_v=3,\theta_{v2}=-3 \\
\gamma=0.2,b=0,1\leq R_j^m\leq10 \\
C_0=5 \\
\alpha=2,\beta=5
$$

### 测试情况

#### 位置验证

| 车辆可信比例（位置验证成功率） | 车辆稀疏（一条边上遇到10-15辆车） | 车辆密集（一条边上遇到20-25辆车） |
| ---- | :-: | :-: |
| 80% | 整体呈缓慢上升趋势，有上下波动；走完2-4条边后信誉值可达到最大，之后在较高水平有上下波动；受位置验证结果顺序影响大 | 走完1-2条边后信誉值可达到最大；同一条边在走到最后时信誉上升幅度很大 |
| 60% | 走完一条边后信誉多数时候减小，有时增加；结果不太稳定，大部分情况不能维持在较高水平 | 整体趋势受位置验证结果顺序影响较大 |
| 40% | 信誉值基本一直在减小 | 信誉值基本一直在减小；受结果顺序影响可能偶尔有上升情况 |

位置验证成功/失败的顺序对信誉计算有较大的影响；考虑每几次位置验证之后统一进行一次信誉更新

### 消息传播

| 评价分布\车辆密度                          | 5                          | 10                                                           | 15                               |
| ------------------------------------------ | -------------------------- | ------------------------------------------------------------ | -------------------------------- |
| 正负面评价各占一半，位置随机分布           | 结果较随机                 | 结果较随机，可信情况略多                                     | 结果较随机，可信情况略多         |
| 少数中心车辆的评价与多数外围车辆的评价相反 | 判定结果一般与中心车辆一致 | 判定结果一般与中心车辆一致，极端情况下（外围车辆极少、评分极端化）与外围车辆一致 | 基本同左，“极端情况”覆盖范围更广 |
|                                            |                            |                                                              |                                  |

注意实际情况中车辆的分布，应当是中心车辆少、外围车辆多，但整体上车辆群体内是均匀分布而非辐射状分布