# 阅读笔记：Using Blockchain for Peer-to-Peer Proof-of-Location

## 背景

位置验证（Proof-of-Location）：一个验证用户在确定时间所处地理位置的电子证书。

- 依赖基础架构（infrastructure）：通过局域网的AP产生位置验证
- 不依赖基础架构：通过邻居产生位置验证



## 设计方案

### 基本结构

- 验证者（Prover）+ 证人（Witness）
- 通过短距离通信方式（如蓝牙）进行交流
- 使用数字签名进行身份验证

### 验证流程

- Prover广播自己的位置验证请求
  - 包括自己的公钥、自己的地理位置、最后一个区块的hash码、时间戳
- Witness检查请求是否符合要求
  - 请求者为网络中的已知联系人
  - 数字签名正确
  - 地理位置信息在可接收范围内
  - 区块hash正确（否则需要进行区块链数据的同步）

- Witness发送响应
  - 包括原请求内容、自己的公钥、自己的地理位置、时间戳
- Prover检查响应
  - 响应来自接收请求的联络人之一
  - 数字签名正确
  - 地理位置信息在可接受范围内
- 广播完整的位置验证信息
- 所有未上传的位置验证信息被整合至新的区块并在网络中广播，如果大部分同伴添加该区块则达成共识

### 分布式共识

Proof-of-Stake：下一个添加到链上的区块由在最近T个区块里包含位置验证信息最多的同伴生成。

- 为了防止垄断，同一个peer在最近T个区块中最多只能有一个是自己生成的。
- 考虑到分支问题，保留（主链上）最近的2T个区块

### 特殊情况

#### 丢弃位置验证信息

- 收到报文中的地理位置信息在附近，但是该同伴非已知联络人，且无法由短距离通讯联系到
- 收到报文中地理位置信息在划定范围之外
  - 保守方法：直接丢弃信息（本文采用的方法）
  - 利用区块链计算两个peer之间的Betweenness，B=0时丢弃位置验证

#### 丢弃区块

- 共识未达成
- 新区块中的位置验证信息不存在于原有区块链中



## 安全性

- 对自己的地理位置造假
- 对别人的地理位置造假
- 重放攻击
- 合谋