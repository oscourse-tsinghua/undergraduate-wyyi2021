# 信誉值计算

## 影响因素

- 来自邻居的消息评价
  - 邻居消息的可信度是根据**该车辆与事件发生位置的距离**判断的；
  - 最终的消息评价（正面/负面）取决于该消息和多数车辆消息给出的判断是否一致。
  - 对少数不一致评价的**敏感度**

- 与邻居交互成功的次数占总交互次数的比例
- 用户注册信息
- 平均速度
- 提交数据时间间隔
- 位置修正前后距离



## 基于消息评价的信誉计算

### 公式

$o_k^j\in[-1,1]$为车辆$k$基于它发出的消息$j$得到的信誉值偏移:
$$
o_k^j=\frac{\theta_1m-\theta_2n}{m+n}
$$
消息$j$产生后被车辆$k$发给它的多个邻居，每个邻居车辆会给出自己对于这条消息的评价并上传到RSU，在RSU上进行上述信誉值的计算。$m$、$n$分别为RSU收到的对于消息$j$的**正面、负面评价数量**，两者的权重计算方式如下：
$$
\theta_1=\frac{F(m)}{F(m)+F(n)},\ \theta_2=\frac{F(n)}{F(m)+F(n)}
$$
其中函数$F$是一个选定的函数，用于控制信誉值对少数态度不一致的消息评价的**敏感度**。比如，使用$F(x)=x^2$时，信誉值对少数群体的敏感度小于使用$F(x)=x$时的信誉值。

### 信誉值获取

一辆车可向RSU发送请求，获取另一个车辆的信誉值；RSU也可根据维护的数据对信誉值过低的车辆发出警告或身份撤销。

合约计算、区块链维护的都是每次根据一个消息计算得到的**偏移值**，累计起来得到车辆当前的信誉值。

### 个人思考

- 该计算方法是基于邻居间事件消息评价的。自己前一部分的工作着重于位置验证和道路修正，如果要参考这个方法，需要进行转换。
  - 正负面消息评价可以转换为：得到邻居确认的位置验证信息占发送的所有位置验证请求的比例
  - 道路修正只在自己的车上进行，不好用这个方法计算
- 敏感度函数是一个可以借鉴的要点，可以更加精确地计算信誉值，并且防止**欺骗性的正面回应**或者**恶意的负面回应**。需要注意如何选择合适的敏感度函数，因为该部分应在智能合约中进行，不支持太复杂的计算。

- 该方法中计算的、保存的是信誉的偏移值，获取完整的信誉值还需要对区块链上的数据进行累加。文章中没有说明这样做的原因，个人感觉用这种方式开销会比较大，如果同步性没有问题的话直接存储信誉值，每次进行修正就可以了。

  不过这样有一个好处，就是如果区块链只保留固定长度或固定时间内的数据链，累加的时候就可以比较智能地排除太早的无用数据。



## 基于朴素贝叶斯的信誉值计算

### 朴素贝叶斯网络

RSU为每一个与之交互的车辆维护一个朴素贝叶斯网络，其根节点内容为$T$，取值为1（可信）或0（不可信），对应概率为$P(T)$。子节点为车辆的不同身份，包括client（交易发起方）和peer（签署方），对应概率分别为$P(client|T)$和$P(peer|T)$。

### 概率计算

根节点处有：
$$
P(T)=\frac{m}{n}，P(T=0)+P(T=1)=1
$$
其中$m$为车辆成功进行的交互数量，$n$为车辆试图进行的交互总数。

同理可以计算子节点处的条件概率，并进一步通过贝叶斯公式计算车辆不同身份下的信誉值，如$P(T=1|client)$

### 信誉值使用

本算法在文章中主要用于其他信息交易时的验证，当RSU管理的信誉值低于阈值时判定交易无效。

### 个人想法

- 文章中没有明确说明这个T取值具体的含义，个人理解车辆总体的信誉就是$P(T=1)$。在这个理解下，我觉得这个网络基本没有发挥太大的作用，有点过于复杂了。
- 这里的“成功交互”被定义为被添加到区块链上的交易/确认信息，我觉得对非成功交互可以有更细致的分类，比如没有对请求进行回复、回复被判定为无效信息等等，对信誉值的影响应该是不同的。
- 文中的client和peer基本可以理解为位置验证中的prover和witness，分别维护车辆不同身份的信誉值是一个很好的想法，但是本文没有进一步的应用，自己目前也没想到什么，总体来说还是有些多余。



## 较为基本的信誉值计算（李玮祺）

### 计算规则

- 将未注册用户的信誉值初始化为0
- 根据当前坐标和上一时间戳坐标，计算平均速度；若平均速度明显过大，将信誉值清零；
- 检查用户最后两次数据提交时间间隔，按档位减小信誉值；
- 当用户连续20次在正常时间范围内提交有效数据时，信誉值增加；
- 对当前位置的修正前后距离不超过20m时，信誉值增加。

### 个人想法

- 比较简单的信誉值计算，使用自我验证的方式，提供了一个基本的框架思路；
- 数据提交时间间隔是一个需要考虑的问题：
  - 在基于消息评价的信誉计算中，信誉值由区块链上的偏移量累加而成，可以忽略掉较早时间的数据，但是如果车辆长时间没有数据提交，只能得到其偏移量为0，应该是不够的，最好还是像这个方法一样有一定衰减。
  - 考虑结合两个方法，如果累加偏移量的方法太麻烦，还是要从直接减小信誉值的角度入手。
- 对于“有效”数据的判定，在自己的工作中要结合邻居验证；
- 应当添加对“无效”数据的筛选或惩罚：
  - 冗余数据的清除：这个可以在车辆本地进行（也许可参考张禹工作）
  - 恶意信息的惩罚：如果有被判定为无效、欺骗性的位置验证信息，应当减小相关车辆信誉值（考虑请求验证者和邻居分别有无参与）

- 根据位置修正结果增加信誉值，个人觉得不是很合适，因为现在的位置修正算法结果完全取决于车辆位置和道路拓扑，跟车辆本身的行为没有太大关系。反倒是可以考虑将信誉值引入车辆的位置验证和修正工作中。